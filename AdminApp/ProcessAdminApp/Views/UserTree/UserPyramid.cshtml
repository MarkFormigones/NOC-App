
    <h2>Drag n Drop</h2>
    <script src="~/Content/assets/tree/jquery-3.4.1.min.js"></script>
    <script src="~/Content/assets/tree/jquery-ui.min.js"></script>
    <link href="~/Content/assets/tree/src/skin-win8/ui.fancytree.css" rel="stylesheet">
    <script src="~/Content/assets/tree/src/jquery.fancytree.js"></script>
    <script src="~/Content/assets/tree/src/jquery.fancytree.dnd.js"></script>
    <script src="~/Content/assets/tree/src/jquery.fancytree.edit.js"></script>
   
    <style type="text/css">
        #draggableSample, #droppableSample {
            height: 100px;
            padding: 0.5em;
            width: 150px;
            border: 1px solid #AAAAAA;
        }

        #draggableSample {
            background-color: silver;
            color: #222222;
        }

        #droppableSample {
            background-color: maroon;
            color: white;
        }

            #droppableSample.drophover {
                border: 1px solid green;
            }
    </style>
    <!-- Add code to initialize the tree when the document is loaded: -->
    <script type="text/javascript">
	$(function(){
		// Attach the fancytree widget to an existing <div id="tree"> element
		// and pass the tree options as an argument to the fancytree() function:
		$("#tree").fancytree({
			extensions: ["dnd", "edit"],
			// titlesTabbable: true,
			source: { url: "/Tree/GetTreeData", cache: false },
			init: function (event, data) {
			    // Set key from first part of title (just for this demo output)
			    data.tree.visit(function (n) {
			        n.key = n.key;
			        n.expanded = true;
			    });
			},
			lazyLoad: function (event, ctx) {
			    ctx.result = { url: "/Tree/GetSubTreeData?Node=" + ctx.node.key, debugDelay: 1000 };
			},	
			dnd: {
				autoExpandMS: 400,
				focusOnClick: true,
				preventVoidMoves: true, // Prevent dropping nodes 'before self', etc.
				preventRecursiveMoves: true, // Prevent dropping nodes on own descendants
				dragStart: function(node, data) {
					/** This function MUST be defined to enable dragging for the tree.
					 *  Return false to cancel dragging of node.
					 */
					return true;
				},
				dragEnter: function(node, data) {
					/** data.otherNode may be null for non-fancytree droppables.
					 *  Return false to disallow dropping on node. In this case
					 *  dragOver and dragLeave are not called.
					 *  Return 'over', 'before, or 'after' to force a hitMode.
					 *  Return ['before', 'after'] to restrict available hitModes.
					 *  Any other return value will calc the hitMode from the cursor position.
					 */
					// Prevent dropping a parent below another parent (only sort
					// nodes under the same parent)
/* 					if(node.parent !== data.otherNode.parent){
						return false;
					}
					// Don't allow dropping *over* a node (would create a child)
					return ["before", "after"];
*/
				   return true;
				},
				dragDrop: function(node, data) {
					/** This function MUST be defined to enable dropping of items on
					 *  the tree.
					 */
				    var mode = data.hitMode;
				    var selectedId = data.otherNode.key;				    
				    var newparentId = -1;
				    alert("Selected: " + selectedId);
				    //alert("receiver: " + newparentId);


				    alert("action: " + mode);
				    if (String(mode).valueOf() == String("over").valueOf()) { //drag the selected node inside desired node.		
				        alert("over" + node.key);
				        newparentId = node.key;				        				       
				    }
				    else { //mode = before or after
				        alert("else statement");
				        if (node.parent.key.search("root_") == 0) { //if root
				            alert("b/a root "+ node.parent.key);
				            newparentId = 0;
				        }
				        else if (node.parent.key.search("root_") == -1) { //if not root
				            alert("b/a non root " + node.parent.key);
				            newparentId = node.parent.key;
				        }		        
				    }

				    $.post('/Tree/UpdateNodeParent', { selectedId: selectedId, parentId: newparentId },
                          function (returnedData) {
                              if (returnedData) { //alert("success update"); 
                              }

                          }).fail(function () {
                              alert("Error on updating");
                          });
				    	data.otherNode.moveTo(node, data.hitMode);
				}
			},
			activate: function(event, data) {
//				alert("activate " + data.node);
			}
		});
	});
    </script>
<div class="example">
    <h1>Example: 'dnd' extension</h1>
    <div class="description">
        <p>
            jQuery UI based Drag-and-Drop support:
        </p>
        <ul>
            <li>
                Support drag-and-drop of tree nodes (inside the same or between
                different trees).
            </li>
            <li>
                Behave like a standard jQuery UI draggable, i.e. allow
                dropping of nodes on standard droppables.
            </li>
            <li>
                Behave like a standard jQuery UI droppable, i.e. allow
                dropping of standard draggables.
            </li>
        </ul>
        <p>
            <b>Note:</b> Consider using the <a href="sample-ext-dnd5.html">
                <i>native</i> drag-and-drop
            </a> extension instead.<br>
            <b>Status:</b> production.
            <b>Details:</b>
            <a href="https://github.com/mar10/fancytree/wiki/ExtDnd"
               target="_blank" class="external">ext-dnd</a>.
        </p>
    </div>
    <div>
        <label for="skinswitcher">Skin:</label> <select id="skinswitcher"></select>
    </div>
    <!-- Add a <table> element where the tree should appear: -->
    <div id="tree">
    </div>
   
</div>

